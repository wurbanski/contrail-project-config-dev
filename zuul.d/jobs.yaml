- job:
    name: base
    parent: null
    description: |
      The base job all other OpenContrail jobs inherit from.

      Everything starts and ends with this base job. It runs pre-playbooks
      which copy job's git repositories prepared by zuul merger to all
      nodes that are part of the nodeset. It also runs post-playbooks
      that upload logs/ to the logserver.
    pre-run: playbooks/base/pre
    post-run:
      - playbooks/base/post-ssh
      - playbooks/base/post-logs
    roles:
      - zuul: codilime/zuul-jobs
    timeout: 28800
    nodeset:
      nodes:
        - name: ubuntu-xenial
          label: ubuntu-xenial-builder
    secrets:
      - site_logs

- job:
    name: contrail-vnc-base
    parent: null
    description: |
      A base job that prepares Contrail VNC sandbox using Android repo
    pre-run: playbooks/contrail/pre

- job:
    name: contrail-vnc-repo-build
    description: |
    run: playbooks/contrail/
    voting: False
    nodeset:
      nodes:
        - name: builder
          label: ubuntu-xenial-small

- job:
    name: contrail-vnc-build-package-ubuntu-base
    parent: contrail-vnc-prepare-repo-sandbox
    description: |
      Job that tests Contrail VNC (controller, analytics, etc.) packaging

      This is a base job for testing packaging of Contrail VNC for Ubuntu-base
      distributions. Release-based variants of this job are then added
      to the Juniper/contrail-packages project.
    run: playbooks/packaging/contrail-vnc.yaml

- job:
    name: contrail-vnc-build-package-ubuntu-trusty
    parent: contrail-vnc-build-package-ubuntu-base
    nodeset:
      nodes:
        - name: builder
          label: ubuntu-trusty-builder

- job:
    name: contrail-vnc-build-package-ubuntu-xenial
    parent: contrail-vnc-build-package-ubuntu-base
    nodeset:
      nodes:
        - name: builder
          label: ubuntu-xenial-builder

- job:
    name: contrail-vnc-prepare-repo-sandbox
    voting: False
    required-projects:
      - Juniper/contrail-api
      - Juniper/contrail-build
      - Juniper/contrail-common
      - Juniper/contrail-controller
      - Juniper/contrail-generateDS
      - Juniper/contrail-heat
      - Juniper/contrail-neutron-plugin
      - Juniper/contrail-nova-extensions
      - Juniper/contrail-nova-vif-driver
      - Juniper/contrail-packages
      - Juniper/contrail-sandesh
      - Juniper/contrail-third-party
      - Juniper/contrail-vrouter
      - Juniper/contrail-webui-third-party
      - Juniper/contrail-web-controller
      - Juniper/contrail-web-core
      - Juniper/contrail-web-server-manager
      - Juniper/contrail-web-storage
    pre-run: playbooks/prepare-repo-sandbox/prepare-repo-sandbox

- job:
    name: contrail-vnc-build-unittest-ubuntu-trusty
    voting: False
    parent: contrail-vnc-prepare-repo-sandbox
    run: playbooks/unittest/contrail
    post-run: playbooks/unittest/post
    nodeset:
      nodes:
        - name: builder
          label: ubuntu-trusty-builder
- job:
    name: contrail-vnc-docker-centos74
    voting: False
    run: playbooks/docker/centos74
    nodeset:
      nodes:
        - name: builder
          label: ubuntu-xenial-builder

- job:
    name: job-a
    run: playbooks/zuulv3/self-test

- job:
    name: job-b
    run: playbooks/zuulv3/self-test

- job:
    name: contrail-vnc-build-package-centos74
    parent: contrail-vnc-prepare-repo-sandbox
    run: playbooks/zuulv3/self-test

- job:
    name: contrail-vnc-docker-provision-centos74
    voting: False
    run: playbooks/docker/centos74-provision-systest
    nodeset:
      nodes:
        - name: contrail-aio
          label: centos-7.4-builder

- job:
    name: pulp-upload
    voting: False
    run: playbooks/pulp-upload
    secrets:
      - site_pulp
